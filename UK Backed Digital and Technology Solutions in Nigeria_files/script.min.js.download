var daffUploadedFiles={};function handleDaffFileInput(obj){const $=jQuery;let data=new FormData;let mbSize=obj.attr("data-file-size");let accept=obj.attr("accept");let maxNumberOfFiles=obj.attr("data-max-files")*1;let canHaveMultiple=maxNumberOfFiles>1;let noFileText=obj.attr("data-no-file-text");let maxSize=obj.attr("data-file-size")*1024*1024;let nonce=obj.attr("data-nonce");let changeFileText=obj.attr("data-change-text");data.append("action","daff_file_up");data.append("_wpnonce",nonce);let inputVal=obj.closest(".et_pb_contact_field").find(":text");let filenameLable=obj.parent().next();if(obj[0].files.length>0){filenameLable.html(`<img width="20" src="${daffData.spinner}" />`)}inputVal.val("");let fieldName=inputVal.attr("name");let uploadedCount=daffUploadedFiles[fieldName].length;for(let file of obj[0].files){let filename=file.name;if(accept.length>0&&accept.indexOf(".")>=0){let acceptTypes=accept.toLowerCase().split(",");let currentFileType="."+filename.toLowerCase().split(".").pop();if(acceptTypes.indexOf(currentFileType)<0){showUploadedFiles(filenameLable,inputVal);obj.val(null);return alert(`Invalid file type "${currentFileType}"!`)}}if(!canHaveMultiple||uploadedCount<maxNumberOfFiles){if(!file){return false}if(file.size>maxSize){alert(`The maximum file size is ${mbSize}MB`)}else{data.append("upload",file);$.ajax({url:daffData.ajaxUrl,type:"post",data:data,contentType:false,processData:false,success:response=>{if(!canHaveMultiple){obj.next().text(changeFileText)}if(response.url){inputVal.val(inputVal.val()+(inputVal.val()?", ":"")+response.url).change().show().css({position:"fixed",width:"0",left:"-10000px"});let uploadedRes={url:response.url,title:filename};if(canHaveMultiple){daffUploadedFiles[fieldName].push(uploadedRes)}else{daffUploadedFiles[fieldName]=[uploadedRes]}showUploadedFiles(filenameLable,inputVal)}}})}}else{alert(`Max Allowed: ${maxNumberOfFiles}`);showUploadedFiles(filenameLable,inputVal);break}uploadedCount++}}function removeDaffFile(e,index){let filenameLable=jQuery(e.target).closest(".divi-simple-file-name");let inputVal=filenameLable.parent().siblings("input");let fieldName=inputVal.attr("name");daffUploadedFiles[fieldName].splice(index,1);showUploadedFiles(filenameLable,inputVal)}function showUploadedFiles(filenameLable,inputVal){let urls=[];filenameLable.html("");let fieldName=inputVal.attr("name");if(daffUploadedFiles[fieldName].length==0){let noFileText=inputVal.parent().find("[data-no-file-text]").attr("data-no-file-text");filenameLable.html(`<div>
<div>${noFileText}</div>
</div>`);inputVal.val("");return}$(".upload-button-container").removeClass("file-index-1");for(let index in daffUploadedFiles[fieldName]){let daffUploadedFile=daffUploadedFiles[fieldName][index];urls.push(`${daffUploadedFile.title} - ${daffUploadedFile.url}`);filenameLable.append(`<div data-uploaded-file-index="${index}" class="uploaded-file-name">${daffUploadedFile.title}</div><div class="cross-container"><img class="daff-cursor-pointer" src="${daffData.xIcon}" onclick="removeDaffFile(event,${index})" width="15" alt=""></div>`);if(index>=1){$(".upload-button-container").addClass("file-index-1")}}inputVal.val(urls.join(" | \n"))}function removeIfHasFile($this){return true;let parent=jQuery($this).closest("label");if(parent.find("input").first().val()){let buttonText=jQuery($this).attr("data-button-text");let noFileText=jQuery($this).attr("data-no-file-text");parent.find("input").first().val("");parent.find("span.upload-label").text(buttonText);parent.next().html(`<div><div>${noFileText}</div></div>`);daffUploadedFiles=[];return false}return true}jQuery(document).ready($=>{$(".divi-star-rating").each(function(){let input=$(this).next();input.hide().val(1).change();$(this).starRating({totalStars:$(this).data("rateit-max"),emptyColor:"lightgray",hoverColor:$(this).data("color"),activeColor:$(this).data("color"),strokeWidth:0,starSize:$(this).data("size"),useGradient:false,useFullStars:true,disableAfterRate:false,initialRating:0,callback:currentRating=>{input.val(currentRating).change()}})});$("[data-create-select2]").each(function(){$(this).select2();$(this).parent().addClass("data-create-select2")});$(".select2-selection__rendered").addClass("et_pb_contact_select").addClass("input");$(".select2-selection.select2-selection--single").each(function(){$(this).css("border-radius",$(this).find(".input").css("border-radius"))});$(".select2-selection__arrow b").each(function(){$(this).css("border-color",$(this).parent().prev().css("color")+" transparent transparent transparent")});$("[data-conditional-recipient]").each(function(){$(this).find("option").each(function(){$(this).text($(this).text().split(":")[0])})});$("[data-date-format]").each(function(){let config=JSON.parse($(this).parent().find(".date-config").text());let format=$(this).data("date-format");let unavailableDates=config.daff_disabled_dates||[];let disabledDays=config.daff_disabled_days.split("|");let options={};if(daffData.language){options=$.datepicker.regional[daffData.language]}options={...options,dateFormat:format,changeYear:true,changeMonth:true,yearRange:"c-99:c+99",beforeShowDay:function(date){let dmy=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2);if(disabledDays&&disabledDays[date.getDay()]&&disabledDays[date.getDay()]=="on"){return[false,"","Unavailable"]}if($.inArray(dmy,unavailableDates)==-1){return[true,""]}else{return[false,"","Unavailable"]}}};if(config.daff_future_dates_only&&config.daff_future_dates_only=="on"){options.minDate=new Date}if(config.daff_past_dates_only&&config.daff_past_dates_only=="on"){options.maxDate=new Date}if(config.daff_max_future_days&&config.daff_max_future_days>0){options.maxDate=`+${config.daff_max_future_days}d`}if(config.daff_max_date){options.maxDate=new Date(config.daff_max_date)}$(this).datepicker(options)});enableFileFields();$("body").bind("DOMSubtreeModified",function(){enableFileFields()});let binded=false;$("#et-fb-app").bind("DOMSubtreeModified",function(){if($("#et-fb-attach_advanced_fields").length){if(!binded){$("#et-fb-attach_advanced_fields").change(function(){if($(this).val()=="on"){$('[data-name="field_type"]').closest(".et-fb-form__group").hide();$("#et-fb-min_length-number").closest(".et-fb-form__group").hide();$("#et-fb-max_length-number").closest(".et-fb-form__group").hide();$("#et-fb-allowed_symbols").closest(".et-fb-form__group").hide()}else{$('[data-name="field_type"]').closest(".et-fb-form__group").show();$("#et-fb-min_length-number").closest(".et-fb-form__group").show();$("#et-fb-max_length-number").closest(".et-fb-form__group").show();$("#et-fb-allowed_symbols").closest(".et-fb-form__group").show()}hideLabels()}).change();trackChange($("#et-fb-attach_advanced_fields")[0]);binded=true}hideLabels()}else if($("#et-fb-r_enable_confirmation").length){hideLabels()}else{binded=false}});$("[data-icon-spacing]").each(function(){let paddingLeft=$(this).css("padding-left");let iconContainer=$(this).siblings(".et_pb_icon_wrap");iconContainer.css("padding-left",paddingLeft);let iconWidth=iconContainer.find("span.et-pb-icon").width();$(this).css("padding-left",paddingLeft.replace("px","")*1+iconWidth+$(this).attr("data-icon-spacing")*1+"px")});$("p.et_pb_contact_field .daff-field-icon").each(function(){$(this).closest(".et_pb_contact_field").addClass("has-daff-field-icon")});function hideLabels(){let fields=["attach_field_type","attach_file_size","attach_multiple_files","attach_file_count","attach_button_text","attach_change_file_label","attach_no_file_label","daff_filename_color","attach_star_design","attach_star_width","attach_star_amount","attach_date_option","attach_date_format","attach_time_format","r_enable_confirmation","r_confirmation_message","r_confirmation_subject","daff_future_dates_only","daff_past_dates_only","daff_max_future_days","daff_max_date","daff_disabled_dates","daff_disabled_days","daff_datepicker_color","daff_field_icon","daff_icon_size","daff_icon_color","daff_icon_spacing","ditr_conditional_recipient","attach_advanced_select2","ditr_send_email_copy","ditr_send_email_copy_to","daff_file_upload_label_color","daff_filename_color"];setTimeout(()=>{for(let field of fields){hideWarning($(`#et-fb-${field}`))}},50)}function enableFileFields(){$(`[data-custom-field-type="file"]`).each(function(){const parent=$(this).parent();if(parent.find(".upload-button-container").length>0){return}let buttonText=$(this).attr("data-button-text");let noFileText=$(this).attr("data-no-file-text");let changeText=$(this).attr("data-change-text");let fileSize=$(this).attr("data-file-size");let nonce=$(this).attr("data-nonce");let accept=$(this).attr("data-custom-field-accept");let maxFiles=$(this).attr("data-max-files");let filenameColor=$(this).attr("data-filename-color");let multiple=$(this).attr("data-has-multiple")?"multiple":"";if(!multiple){maxFiles=1}parent.find("input").hide();let fieldName=parent.find("input").attr("name");daffUploadedFiles[fieldName]=[];let hideNoFile="";parent.append(`
<div class="upload-button-container">

        <label  class="input daff-cursor-pointer divi-simple-upload-button button btn btn-primary primary-button et_pb_button">
        <input ${multiple} data-max-files="${maxFiles}" onclick="return removeIfHasFile(this)"  accept="${accept}"  type=file class="daff-d-none" onchange="handleDaffFileInput(jQuery(this))" data-file-size="${fileSize}" data-no-file-text="${noFileText}" data-nonce="${nonce}" data-change-text="${changeText}" data-button-text="${buttonText}" /> 
        <span class="upload-label">${buttonText}</span>
        </label>
        <div class="divi-simple-file-name  daff-bg-transparent" style="color: ${filenameColor}">
        <div>${noFileText}</div>
</div>
</div>
        `)})}function hideWarning(elemnt){elemnt.closest(".et-fb-option-container").find(".et-fb-no-vb-support-warning").hide()}MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var trackChange=function(element){var observer=new MutationObserver(function(mutations,observer){if(mutations[0].attributeName=="value"){$(element).trigger("change")}});observer.observe(element,{attributes:true})};$(".daff-visible-on-load").show()});